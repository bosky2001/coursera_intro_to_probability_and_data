---
title: "Exploring the BRFSS data"
author: "Raghavesh Viswanath"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
    df_print: paged
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(ggpubr)
library(gridExtra)
library(scales)
```

### Load data

Make sure your data and R Markdown files are in the same directory. When loaded
your data file will be called `brfss2013`. Delete this note when before you submit 
your work. 

```{r load-data}
load("brfss2013.RData")
```



* * *

## Part 1: Data

The Behavioral Risk Factor Surveillance System (BRFSS) is a project by the Center for Disease Control and Prevention (CDC) and United State territories. These territories include the 50 states, District of Columbia, Guam, and Puerto Rico. The objective can be brilliantly noted from the BRFSS code book, "The BRFSS objective is to collect uniform, state-specific data on preventive health practices and risk behaviors that are linked to chronic diseases, injuries, and preventable infectious diseases that affect the adult population. Factors assessed by the BRFSS in 2013 include tobacco use, HIV/AIDS knowledge and prevention, exercise, immunization, health status, healthy days â€” health-related quality of life, health care access, inadequate sleep, hypertension awareness, cholesterol awareness, chronic health conditions, alcohol consumption, fruits and vegetables consumption, arthritis burden, and seat belt use. Since 2011, BRFSS conducts both land line telephone- and cellular telephone-based surveys". [BRFSS Codebook](https://d18ky98rnyall9.cloudfront.net/_e34476fda339107329fc316d1f98e042_brfss_codebook.html?Expires=1546732800&Signature=SJOyYchcC6I1i0V5DJzc2zNIWFtX~ZZ6RVuQtnUBMH9QaXun29NOPPFrYD5sDVmOxRX0cYiN0sj3WGS3paGxCU1Qv5n1gI0xFh-9py-d4YpPW8aDeJJSFZsOwUxIjeDYAabQtvizujb1CpaQG2oam6Ojr43MhgLUTAjnIpTuyHI_&Key-Pair-Id=APKAJLTNE6QMUY6HBC5A)

I believe this is hard to generalize for all those who resides in these states, states referring to the 50 states and the other territories. The data are collected from through either a land line telephone or a cellular telephones. These phone numbers were selected at random from those who are adults, adults being age 18+. The adults are the target population for looking at health trends. The randomly selected phones also must reside in a private residence or in college housing. Thus, this generalization comes from the population described above. There is no causality due to this being an observational study.


* * *

## Part 2: Research questions

**Research question 1:**

What is relation between income and education level of our  

Variables Required: income2, educa

**Research question 2:**

One of the first research question involves how sleeptime of an US citizen have any affects on chronic health condition specifically depressive disorder, specifically for those category of people who sleep for less than 7 hours.

Variables Required: sleptim1, addepev2

**Research question 3:**

Is there a correlation between being a veteran and poor physical or mental health, and can an association between both aforementioned variables and binge drinking be inferred?

Variables Required: veteran3,poorhlth 

* * *

## Part 3: Exploratory data analysis

NOTE: Insert code chunks as needed by clicking on the "Insert a new code chunk" 
button (green button with orange arrow) above. Make sure that your code is visible
in the project you submit. Delete this note when before you submit your work.

**Research question 1:**

Is there a time of year where the interview is not coded as fully completed? Would months with more holidays result in a change of completed interviews? Looking further into this, is there a state that sticks out for these cases?

Variables Required: income2, educa

#### Select Variables of Interest

To reduce the size of data we are working with I will select only the columns we are interested and rename the columns so they are easier to work with.

```{r}
q1<-data.frame(Income=brfss2013$income2, EducationLevel=brfss2013$educa)
T1<-table(q1)
T1<-data.frame(T1)
unique(T1$EEducationLevel)
H1<-subset(T1,T1$EducationLevel="Never attended school or only kindergarten")
H1<-cbind(H1,Prop=H1$Freq/colSums(H1[,3,drop=FALSE]))

H2<-subset(T1,T1$EducationLevel="Grades 1 through 8 (Elementary)")
H2<-cbind(H2,Prop=H2$Freq/colSums(H2[,3,drop=FALSE]))

H3<-subset(T1,T1$EducationLevel="Grades 9 though 11 (Some high school)")
H3<-cbind(H3,Prop=H3$Freq/colSums(H3[,3,drop=FALSE]))

H4<-subset(T1,T1$EducationLevel="Grade 12 or GED (High school graduate)")
H4<-cbind(H4,Prop=H4$Freq/colSums(H4[,3,drop=FALSE]))

H5<-subset(T1,T1$EducationLevel="College 1 year to 3 years (Some college or technical school)")
H5<-cbind(H5,Prop=H5$Freq/colSums(H5[,3,drop=FALSE]))

H6<-subset(T1,T1$EducationLevel="College 4 years or more (College graduate)")
H6<-cbind(H6,Prop=H6$Freq/colSums(H6[,3,drop=FALSE]))

windows()
par(mfrow=c(2,3))

g1<-ggplot(H1,aes(x="",y=Prop,fill=Income))+scale_color_viridis(option = "D")
g1+geom_bar(stat="identity",color="white")+coord_polar("y",start=0)+theme_void()+scale_color_viridis(discrete = TRUE, option = "D")+scale_fill_viridis(discrete = TRUE) 


g2<-ggplot(H2,aes(x="",y=Prop,fill=Income))+scale_color_viridis(option = "D")
g2+geom_bar(stat="identity",color="white")+coord_polar("y",start=0)+theme_void()+scale_color_viridis(discrete = TRUE, option = "D")+scale_fill_viridis(discrete = TRUE) 


g3<-ggplot(H3,aes(x="",y=Prop,fill=Income))+scale_color_viridis(option = "D")
g3+geom_bar(stat="identity",color="white")+coord_polar("y",start=0)+theme_void()+scale_color_viridis(discrete = TRUE, option = "D")+scale_fill_viridis(discrete = TRUE) 


g4<-ggplot(H4,aes(x="",y=Prop,fill=Income))+scale_color_viridis(option = "D")
g4+geom_bar(stat="identity",color="white")+coord_polar("y",start=0)+theme_void()+scale_color_viridis(discrete = TRUE, option = "D")+scale_fill_viridis(discrete = TRUE) 


g5<-ggplot(H5,aes(x="",y=Prop,fill=Income))+scale_color_viridis(option = "D")
g5+geom_bar(stat="identity",color="white")+coord_polar("y",start=0)+theme_void()+scale_color_viridis(discrete = TRUE, option = "D")+scale_fill_viridis(discrete = TRUE) 


g6<-ggplot(H6,aes(x="",y=Prop,fill=Income))+scale_color_viridis(option = "D")
g6+geom_bar(stat="identity",color="white")+coord_polar("y",start=0)+theme_void()+scale_color_viridis(discrete = TRUE, option = "D")+scale_fill_viridis(discrete = TRUE) 
```

#### Variable Exploration

```{r}
summary(raw_rq1)
```

Looking at year, month, and dispcode we can see there are missing data. These will be removed later to assure we are working with complete cases.

I want to make sure we are only looking at the expected 50 states, District of Columbia, Guam, and Puerto Rico.

```{r}
raw_rq1 %>% count(state)
```

We are expecting 53 values, however there are 55 in the table. Scrolling through the table we find 2 unexpected values; 0 and 80. 0 and 80 are not in the [State FIPS list](https://www.mcc.co.mercer.pa.us/dps/state_fips_code_listing.htm). Thus, these will be removed.

#### Final Clean Data for Research Question 1

```{r}
rq1 <- raw_rq1 %>%
  filter(!is.na(year),
         !is.na(month),
         !is.na(dispcode),
         state != '0',
         state != '80')
```

Confirmation all NAs were removed:

```{r}
sum(is.na(rq1))
```

#### Exploration

I have chosen to use the **zoo** library to utilize the yearmon function. yearmon gives a year and month combo a numeric value which makes it easy for plotting across time.

```{r, message=F}
library(zoo)
rq1 <- rq1 %>%
  mutate(yearMon = as.yearmon(paste(year,month), '%Y %B'))
```
yearMon = as.yearmon(paste(year,month), '%Y %B')
```{r}
rq1_summary <- rq1 %>%
  group_by(year, month, dispcode) %>%
  summarise(count = n()) %>%
  mutate(proportion = count / sum(count)) %>%
  ungroup() %>%
  mutate(yearMon = as.yearmon(paste(year,month), '%Y %B'))

rq1_summary
```


```{r}
ggplot(rq1_summary, aes(yearMon, count, color = dispcode)) +
  geom_line() +
  scale_x_yearmon(n=20) +
  rotate_x_text(45) +
  labs(x = 'Year Month', y = 'Count', title = 'Count of dispcode Across Time')
```

Looking at the counts of interviews we can see there is a lot more complete interviews VS partially completed. Most counts for completed interviews are between 30,000 and 40,000. Partially interviewed follow the same count around 5,000. After 2013 the drop severely drops. The data is called 2013, so I am not sure why 2014 data is in here and after seeing these lower than normal counts I am not sure we can trust the 2014 data. Without having a domain expert or someone familiar with these data I will keep it in for the rest of the analysis.

Looking at proportion of interviews completed and partially completed will help us compare the two groups.

```{r}
ggplot(rq1_summary, aes(yearMon, proportion, color = dispcode)) +
  geom_line() +
  scale_x_yearmon(n=20) +
  rotate_x_text(45) +
  labs(x = 'Year Month', y = 'Proportion', title = 'Proportion of dispcode Across Time')
```

Excluding the 2014 data, the proportions are consistent. It is interesting to see that about 12% of interviews are constantly partially completed. 12% Can contribute to a lot of rows with missing data. It would be great to see this number decrease.

Lets look at state. We will need to make a new summary to include state. We will be exploring dispcode by state.

```{r}
rq1_summary2 <- rq1 %>%
  group_by(state, dispcode) %>%
  summarise(count = n()) %>%
  mutate(proportion = count / sum(count)) %>%
  filter(dispcode == 'Partially completed interview')

rq1_summary2
```

In our research question we are interested in partially completed interviews. It would be hard to interpret a plot with 53 lines, one per state. Thus we will look

```{r}
ggplot(rq1_summary2, aes(reorder(state, - proportion), proportion)) +
  geom_col() +
  rotate_x_text(90) +
  labs(x = 'States', y = 'Proportion', title = '% of Partially Completed Interviews')
```

Higher % is not better in this plot. A higher % means more interviews were not complete. In California 1 in 4 interviews will be partially completed. We can see that there is not a constant % of partially completed across the states. 3 states have good low rates of partially completed; West Virginia, Tennessee, and Puerto Rico. I believe this is an interesting question to investigate further, why is the variability of % among partially completed interviews so high?

We saw interview status is constant in 2013. However, when looking at the percentage of partially completed interviews there is not a constant result per state. There is a strong view for some states having low percentage of partially completed interviews Vs. those who have high percentage.

---

**Research question 2:**

One of the first research question involves how sleeptime of an US citizen have any affects on chronic health condition specifically depressive disorder, specifically for those category of people who sleep for less than 7 hours.

Variables Required: sleptim1, addepev2

#### Select Variables of Interest

```{r}
SLD <- dataframe(brfss2013$sleptim1,brfss2013$addepev2)
```

#### Variable Exploration

```{r}
SLD_clean<-na.omit(SLD)
up_dep<- SLD_clean %>%
  filter(sleptim1<5) %>%
  group_by(addepev2) %>%
  summarise(count=n())
```
Filtering the data to get what we need using the piping operations
#### Exploration

Plotting the data to make inferences.

```{r}
ggplot(data=up_dep,aes(x=addepev2,y=count))+geom_bar(stat="identity",color='blue',fill='green')+xlab("Depressive Order for people having <7 hours of sleep?")+ylab("Number of Respondents")
```
As normal Human Beings require atleast 7 hours of sleep daily, i wanted to know if less sleep than usual would lead to them having depressive disorder(pretty far fetched thought) Results indicate that majority dont report having a depressive disorder.

**Research question 3:**
Is there a correlation between being a veteran and poor physical or mental health?

Variables Required: veteran3, poorhlth

#### Select Variables of Interest
Filtering out rows containing NA as they are useless.
```{r}
q2tbl <- brfss2013 %>% filter(!(is.na(veteran3)), !(is.na(poorhlth)))
```

#### Variable Exploration

```{r}
q2tbl <- q2tbl %>% mutate(poorhlth = ifelse(poorhlth > 7, "8+", poorhlth))
q2tbl$poorhlth <- factor(q2tbl$poorhlth)
```
In the statistics above, we generalize days binge drank in the last month exceeding a week as '8+' to indicate excessive binge drinking. The summary statistics illustrate a choppy normal distribution of proportions of veterans binge drinking, with the distribution fluctuating up and down independent from the number of days binge drank, hinting at a possible correlation.

```{r}
q2tbl %>% group_by(poorhlth, veteran3) %>% summarize(count=n())
```



#### Exploration


```{r}
library("viridis")
q2plt <- ggplot(q2tbl) + aes(x = veteran3, fill = poorhlth) + geom_bar(position = "fill")+scale_color_viridis(option = "D")
q2plt <- q2plt +  + xlab("Veteran, ) + ylab("Relative Proportion")+  scale_color_viridis(discrete = TRUE, option = "D")+ scale_fill_viridis(discrete = TRUE)
q2plt

```
The plot illustrates a normal distribution for no days of poor health across 0 through 8+ days spent binge drinking in the last month and a an increasing linear trend for poor health across the same range Moreover, there were proportionately less veterans than non-veterans who reported little to no days of poor health consistently across 0 through 8+ days spent binge drinking and proportionately more veterans who reported more days of poor health than non-veterans consistent across the same range. This trend indicates that there is a strong correlation between being a veteran, poor physical or mental health, and binge drinking.

